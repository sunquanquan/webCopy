(function (b) {
    b.MPT = new function () {
        var f = {};
        this.bind = function (c, d, e) {
            if (c.attachEvent) {
                c.attachEvent("on" + d, e)
            } else {
                c.addEventListener(d, e, false)
            }
        };
        this.addAction = function (d, c) {
            if (f[d]) {
                alert("[错误]您新增的动作名已经存在！");
                return
            } else {
                f[d] = c
            }
        };
        this.excAction = function (e) {
            var c = h(e);
            for (var d = 0; d < c.length; d++) {
                f[c[d]["action_name"]](c[d]["element"])
            }
        };

        var h = function (q) {

            var d = [];
            if (q.getElementsByClassName) {
                var i = q.getElementsByClassName("mpt")
            } else {
                var i = q.getElementsByTagName("*")
            }
            var r = i.length;
            for (var p = 0; p < r; p++) {
                var c = i[p].getAttribute("class") || i[p].getAttribute("classname");
                if (!c) {
                    continue
                }
                var o = /\sa_(\w+)/;
                var e = c.match(o);
                if (e && e[1]) {
                    if (f[e[1]]) {
                        d.push({action_name: e[1], element: i[p]})
                    } else {
                        alert("[错误]动作列表中未找到" + e[1] + "方法")
                    }
                }
            }
            return d
        };
        var g = {};
        this.addTmpl = function (d, c) {
            a(g, d, 'addTmpl("' + d + '", ...) 添加模板重名！', function () {
                g[d] = c
            })
        };
        this.getTmpl = function (d, c) {
            return g[d]((!c ? {} : c))
        };
        var a = function (e, j, c, d) {
            if (e.hasOwnProperty(j)) {
                throw c;
                return
            } else {
                d()
            }
        }
    };
    b.MPT.bind(b, "load", function () {

        b.MPT.excAction(document)
    })
})(window);